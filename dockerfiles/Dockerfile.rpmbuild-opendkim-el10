#
# Build-time image for AL10 OpenDBX → OpenDKIM RPMs
#
FROM almalinux/10-kitten-init

# ─────────────── Repos ───────────────
RUN dnf -y install dnf-plugins-core && \
    dnf -y config-manager --set-enabled crb && \
    dnf -y install epel-release && \
    dnf clean all

# ─────────── Base tool-chain ──────────
RUN dnf -y groupinstall "Development Tools" && \
    dnf -y install rpm-build rpmdevtools redhat-rpm-config \
       openssl-devel openldap-devel sendmail-milter-devel libbsd-devel \
       mariadb-connector-c mariadb-connector-c-devel libpq-devel \
       sqlite-devel firebird-devel freetds-devel ncurses-devel readline-devel \
       docbook2X doxygen automake gettext gettext-devel libtool \
       systemd which curl && \
    dnf clean all

# ──────── Non-root builder setup ──────
RUN useradd -m builder && su - builder -c "rpmdev-setuptree"
WORKDIR /home/builder
USER builder

# ───────────── SRPM payloads ──────────
RUN curl -LO https://dl.fedoraproject.org/pub/epel/9/Everything/source/tree/Packages/o/opendbx-1.4.6-38.el9.src.rpm && \
    curl -LO https://dl.fedoraproject.org/pub/epel/9/Everything/source/tree/Packages/o/opendkim-2.11.0-0.36.el9.src.rpm
